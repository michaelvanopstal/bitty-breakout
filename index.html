<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PointPay Breakout</title>

  <!-- Preloads -->
  <link rel="preload" href="vlaggetje1.png" as="image">
  <link rel="preload" href="vlaggetje2.png" as="image">
  <link rel="preload" href="signalblock2.png" as="image">

  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- ===== Chat Box (rechts) ===== -->
  <div id="chatbox">
    <div class="chatbox-header">
      <button id="chatToggleBtn" class="chat-icon-btn" type="button" title="Open/dicht" aria-label="Chat openen of sluiten">‚ñ∏</button>
      <span>CHAT</span>
      <button id="chatClearBtn" class="chat-icon-btn" type="button" title="Leeg chat" aria-label="Chat leegmaken">‚úï</button>
    </div>

    <!-- Sticker popup -->
    <div id="chat-sticker-panel" aria-label="Kies een sticker"></div>

    <!-- berichtenlijst -->
    <div id="chatMessages" aria-live="polite"></div>

    <!-- invoer onderaan de chat -->
    <form id="chatForm" autocomplete="off">
      <input id="chatName" type="text" placeholder="Player: michael" maxlength="18" />
      <input id="chatInput" type="text" placeholder="Schrijf een bericht..." maxlength="200" />
      <!-- üì∑ Camera-icoon opent nu de sticker-popup -->
      <button id="chatStickersBtn" class="chat-icon-btn" type="button" title="Kies een plaatje">üì∑</button>
      <button id="chatSendBtn" type="submit" title="Stuur">‚ñ∂</button>
    </form>
  </div>
  <!-- ===== /Chat Box ===== -->

  <!-- 1x STICKERS definieren -->
  <script>
    const STICKERS = [
      'grumpy (11).png',        'ittybittybaseball (1).png',  'Itty Bitty Flower GIF by herecomesbitcoin (1).gif',
      'Sandwich (7).png',       'Graffiti (3).png',
      'jack-mallers (2).png',   'Satoshi (6).png',
      'Construction (7).png',   'Cat (4).png',
      'Astronaut (2).png',      'girls-night-out.png',
      'Bitcoinbahama (3).png',
      'Nostrich (3).png',
      'Queen (8).png',
      'UFO (8).png',
      'Coder.png',
      'Bitcoin Blockchain GIF by herecomesbitcoin.gif',
      'Bitcoin Cryptocurrency Sticker by herecomesbitcoin (1).gif',
      'Bitcoin Cryptocurrency Sticker by herecomesbitcoin (2).gif',
      'Bitcoin Cryptocurrency Sticker by herecomesbitcoin (3).gif',
      'Bitcoin Cryptocurrency Sticker by herecomesbitcoin (4).gif',
      'Bitcoin Cryptocurrency Sticker by herecomesbitcoin (5).gif',
      'Bitcoin Cryptocurrency Sticker by herecomesbitcoin.gif',
      'Cat Crypto Sticker by herecomesbitcoin.gif',
      'Crypto Bitcoin GIF by herecomesbitcoin.gif',
      'Crypto Bitcoin Sticker by herecomesbitcoin (3).gif',
      'Crypto Dancing GIF by herecomesbitcoin (3).gif',
      'Hieronymus Bosch Bitcoin Sticker by herecomesbitcoin.gif',
      'Jack Dorsey Bitcoin Sticker by herecomesbitcoin.gif',
      'San Francisco Dancing GIF by herecomesbitcoin.gif',
       'BITTYbread.gif',
      'bittymoney.gif',
      'ufobitty.gif',
      'fallingbitty.gif',
      'bird.gif',
      'btty.gif',
      'bttyhead.gif',
      'queen.gif',
      'satoschi.gif',
      
    ];
  </script>

  <!-- ===== BONUS POWER los van chat ===== -->
  <div id="bonus-power-panel">
    <div class="bp-header">BONUS POWER</div>

    <!-- ‚ù§Ô∏è HARTJES METER -->
    <div class="bp-row" data-type="hearts">
      <div class="bp-icon bp-icon-heart"></div>
      <div class="bp-tube">
        <div class="bp-liquid" id="bp-hearts-liquid"></div>
        <div class="bp-glass"></div>
      </div>
      <div class="bp-value" id="bp-hearts-value">0/10</div>
    </div>

    <!-- ‚≠ê STERREN METER -->
    <div class="bp-row" data-type="stars">
      <div class="bp-icon bp-icon-star"></div>
      <div class="bp-tube">
        <div class="bp-liquid" id="bp-stars-liquid"></div>
        <div class="bp-glass"></div>
      </div>
      <div class="bp-value" id="bp-stars-value">0/10</div>
    </div>

    <!-- üí£ BOM METER -->
    <div class="bp-row" data-type="bombs">
      <div class="bp-icon bp-icon-bomb"></div>
      <div class="bp-tube">
        <div class="bp-liquid" id="bp-bombs-liquid"></div>
        <div class="bp-glass"></div>
      </div>
      <div class="bp-value" id="bp-bombs-value">0/10</div>
    </div>

    <!-- ‚ùå KRUIS METER -->
    <div class="bp-row" data-type="cross">
      <div class="bp-icon bp-icon-cross"></div>
      <div class="bp-tube">
        <div class="bp-liquid" id="bp-cross-liquid"></div>
        <div class="bp-glass"></div>
      </div>
      <div class="bp-value" id="bp-cross-value">0/3</div>
    </div>
  </div>

  <!-- andere elementen die je al had -->
  <span id="player-display">Player</span>
  <span id="scoreDisplay">0</span>

  <!-- Tooltip -->
  <div id="resetTooltip" style="
    display: none;
    position: fixed;
    bottom: 100px;
    right: 100px;
    background-color: rgba(0, 0, 0, 0.85);
    color: white;
    padding: 6px 10px;
    border-radius: 6px;
    font-size: 13px;
    font-family: Arial, sans-serif;
    z-index: 13000;
    white-space: nowrap;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
  ">Use when the ball is stuck ‚Äî no lives will be lost.</div>

  <!-- Reset-knop -->
  <img id="resetBallBtn" 
      src="resetball.png" 
      alt="Reset Ball" 
      style="
        position: fixed;
        bottom: 40px;
        right: 30px;
        width: 100px;
        height: 100px;
        cursor: pointer;
        z-index: 300;
        transition: transform 0.2s ease;
      "
      onmouseover="this.style.transform='scale(1.1)'"
      onmouseout="this.style.transform='scale(1)'"
  >

 <!-- Firebase compat libraries -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCkY9v2Hh84wb1IluKFPbDsjTCJjw_P8wc",
    authDomain: "bitty-brickshift.firebaseapp.com",
    databaseURL: "https://bitty-brickshift-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "bitty-brickshift",
    storageBucket: "bitty-brickshift.appspot.com",
    messagingSenderId: "823337012487",
    appId: "1:823337012487:web:1d217b13195f48809389a2"
  };

  // init
  firebase.initializeApp(firebaseConfig);

  // refs
  const db        = firebase.database();
  const chatRef   = db.ref("chat");
  const scoresRef = db.ref("scores");

  // globaal maken
  window.chatRef   = chatRef;
  window.scoresRef = scoresRef;

  console.log("‚úÖ Firebase connected!");
</script>


  <!-- ‚úÖ CHAT SCRIPT (nu met Firebase) -->
  <script>
  (() => {
    const $msgs   = document.getElementById('chatMessages');
    const $form   = document.getElementById('chatForm');
    const $input  = document.getElementById('chatInput');
    const $name   = document.getElementById('chatName');
    const $clear  = document.getElementById('chatClearBtn');

    const stickerPanel = document.getElementById('chat-sticker-panel');
    const stickerBtn   = document.getElementById('chatStickersBtn');

    const STORE_KEY = 'bb_chat_messages';
    const LIMIT = 100;

    let selectedSticker = null;
    let currentStickerEl = null;

    function detectPlayerName() {
      let playerName = '';

      const nameInput = document.querySelector('#playerNameInput, #player-name, input[name="playerName"]');
      const display   = document.getElementById('player-display');

      if (nameInput && nameInput.value.trim() !== '') {
        playerName = nameInput.value.trim();
      } else if (display && display.textContent.trim() !== '' && display.textContent.trim() !== 'Player') {
        playerName = display.textContent.trim();
      }

      if (!playerName && localStorage.getItem('chatName')) {
        playerName = localStorage.getItem('chatName');
      }

      return playerName || 'Anon';
    }

    function updateChatName() {
      const name = detectPlayerName();
      if ($name) {
        $name.value = name;
        $name.disabled = true;
      }
      localStorage.setItem('chatName', name);
    }
    updateChatName();
    setInterval(updateChatName, 1000);

    function getStore(){
      try{ return JSON.parse(localStorage.getItem(STORE_KEY)) || []; }
      catch(e){ return []; }
    }
    function setStore(arr){
      try{ localStorage.setItem(STORE_KEY, JSON.stringify(arr)); }catch(e){}
    }

    function pad(n){ return String(n).padStart(2,'0'); }
    function nowTime(){
      const d = new Date();
      return `${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }

    function escapeHTML(s){
      return s.replace(/[&<>"']/g, c => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'
      }[c]));
    }
    function linkify(s){
      return s.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" rel="noopener">$1</a>');
    }

    function appendChatMessage(m){
      if (!$msgs) return;
      const wrap = document.createElement('div');
      wrap.className = 'chat-msg';

      let html = `<div class="chat-meta">${m.time || '--:--'} ‚Äî <b>${escapeHTML(m.name || 'Anon')}</b></div>`;
      if (m.text) {
        html += `<div class="chat-text">${linkify(escapeHTML(m.text))}</div>`;
      }
      if (m.img) {
        html += `<img src="${m.img}" class="chat-thumb" alt="image">`;
      }

      wrap.innerHTML = html;
      $msgs.appendChild(wrap);
      $msgs.scrollTop = $msgs.scrollHeight;
    }

    function render(all){
      if (!$msgs) return;
      $msgs.innerHTML = '';
      all.forEach(appendChatMessage);
    }

    // bericht toevoegen -> naar Firebase
    function addMessage(name, text, imgData = null){
      const msg = {
        name: name,
        text: text,
        img: imgData,
        time: nowTime()
      };

      if (window.chatRef) {
        console.log('[chat] probeer te pushen naar Firebase:', msg);
        window.chatRef.push(msg, (err) => {
          if (err) {
            console.error('[chat] Firebase push MISLUKT:', err);
          } else {
            console.log('[chat] Firebase push GELUKT ‚úÖ');
          }
        });
      } else {
        console.warn('[chat] geen chatRef -> gebruik localStorage');
        let all = getStore();
        if(all.length >= LIMIT){
          all = [{name:'System', text:'Chat automatisch geleegd (100 berichten).', time:nowTime()}];
        }
        all.push(msg);
        setStore(all);
        render(all);
      }
    }

    // Firebase luisteraar
    if (window.chatRef) {
      window.chatRef.limitToLast(200).on('child_added', snap => {
        const m = snap.val();
        console.log('[chat] nieuw bericht uit Firebase:', m);
        appendChatMessage(m);
      });
    } else {
      render(getStore());
    }

    if ($form) {
      $form.addEventListener('submit', e=>{
        e.preventDefault();
        const name = detectPlayerName();
        const text = $input.value.trim();

        if (!text && !selectedSticker) return;

        addMessage(name, text, selectedSticker);

        $input.value = '';
        $input.focus();

        selectedSticker = null;
        if (currentStickerEl) {
          currentStickerEl.classList.remove('selected');
          currentStickerEl = null;
        }
        if (stickerPanel) stickerPanel.style.display = 'none';
      });
    }

    if ($clear) {
      $clear.addEventListener('click', ()=>{
        setStore([]);
        render([]);
      });
    }

    if ($input) {
      $input.addEventListener('keydown', e=>{
        if(e.key === 'Enter' && !e.shiftKey){
          e.preventDefault();
          $form.requestSubmit();
        }
      });
    }

    // STICKER PANEL
    if (stickerBtn && stickerPanel) {
      const imageGrid = document.createElement('div');
      imageGrid.className = 'sticker-grid';

      const gifGrid = document.createElement('div');
      gifGrid.className = 'sticker-grid';

      const imgTitle = document.createElement('div');
      imgTitle.textContent = 'Stickers';
      imgTitle.className = 'sticker-section-title';

      const gifTitle = document.createElement('div');
      gifTitle.textContent = 'GIFs';
      gifTitle.className = 'sticker-section-title';

      const list = Array.isArray(STICKERS) ? STICKERS : [];
      list.forEach(src => {
        const item = document.createElement('div');
        item.className = 'sticker-item';

        const img = document.createElement('img');
        img.src = src;
        img.alt = 'sticker';
        item.appendChild(img);

        item.addEventListener('click', () => {
          if (selectedSticker === src) {
            selectedSticker = null;
            item.classList.remove('selected');
            currentStickerEl = null;
            return;
          }
          selectedSticker = src;
          if (currentStickerEl) currentStickerEl.classList.remove('selected');
          item.classList.add('selected');
          currentStickerEl = item;
        });

        item.addEventListener('dblclick', () => {
          const name = detectPlayerName();
          const text = $input ? $input.value.trim() : '';
          addMessage(name, text, src);

          if ($input) {
            $input.value = '';
            $input.focus();
          }
          selectedSticker = null;
          if (currentStickerEl) {
            currentStickerEl.classList.remove('selected');
            currentStickerEl = null;
          }
          stickerPanel.style.display = 'none';
        });

        if (src.toLowerCase().endsWith('.gif')) {
          gifGrid.appendChild(item);
        } else {
          imageGrid.appendChild(item);
        }
      });

      stickerPanel.innerHTML = '';
      stickerPanel.appendChild(imgTitle);
      stickerPanel.appendChild(imageGrid);
      stickerPanel.appendChild(gifTitle);
      stickerPanel.appendChild(gifGrid);

      stickerBtn.addEventListener('click', () => {
        const show = (stickerPanel.style.display === '' || stickerPanel.style.display === 'none');
        stickerPanel.style.display = show ? 'block' : 'none';
      });
    }

  })();
  </script>

  <div id="game-container">
    <canvas id="gameCanvas" width="645" height="650"></canvas>
  
    <div id="time-box">
      <span id="timeDisplay">00:00</span>
    </div>

    <div id="login-overlay">
      <div id="login-box">
        <input type="text" id="player-name" placeholder="Voer je naam in" />
        <button id="login-btn">Login</button>
        <button id="logout-btn" style="display: none;">Logout</button>
      </div>
    </div>
    <img id="musicToggle" src="playmusic button.png" alt="Play Music" style="cursor: pointer; width: 180px;" />
    <div id="highscore-overlay">
      <ol id="highscore-list">
        <li></li><li></li><li></li><li></li><li></li>
        <li></li><li></li><li></li><li></li><li></li>
      </ol>
    </div>
  </div>

  <div id="hud" style="position: absolute; top: 10px; left: 80px; z-index: 1000;">
    <div id="livesDisplay" style="display: flex; gap: 6px;"></div>
  </div>

  <img src="beker_clipped_rev_2.png" id="trophy" alt="Trophy">

  <script src="login.js"></script>
  <script src="game.js"></script>




 
   <script>
  let highscores = JSON.parse(localStorage.getItem("highscores")) || [
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 },
    { name: "‚Äî", score: 0, time: "00:00", level: 1 }
  ];

  function updateHighscoreBoard() {
    const highscoreList = document.getElementById("highscore-list");
    if (!highscoreList) return;

    highscoreList.innerHTML = "";
    highscores.forEach((entry, index) => {
      const levelText = entry.level ? `‚Äî Level ${entry.level}` : "";
      const li = document.createElement("li");
      li.textContent = `${index + 1}. ${entry.name} ‚Äî ${entry.score} ‚Äî ${entry.time} ${levelText}`;
      highscoreList.appendChild(li);
    });
  }

  // üëâ deze wordt door je game aangeroepen
  function checkAndUpdateHighscores(name, score, time, level = 1) {
    console.log("üèÅ checkAndUpdateHighscores aangeroepen met:", name, score, time, level);

    const newEntry = { name, score, time, level };
    highscores.push(newEntry);
    highscores.sort((a, b) => b.score - a.score || a.time.localeCompare(b.time));
    highscores = highscores.slice(0, 10);
    localStorage.setItem("highscores", JSON.stringify(highscores));
    updateHighscoreBoard();

    // ‚ú® ook naar Firebase sturen
    if (window.scoresRef) {
      console.log("üì° scoresRef gevonden, push naar Firebase...");
      window.scoresRef.push({
        name: name,
        score: score,
        time: time,
        level: level,
        created: Date.now()
      })
      .then(() => {
        console.log("‚úÖ Score toegevoegd aan Firebase");
      })
      .catch(err => {
        console.error("‚ùå Kon score niet naar Firebase pushen:", err);
      });
    } else {
      console.warn("‚ö†Ô∏è window.scoresRef bestaat niet op dit moment, niets naar Firebase gestuurd.");
    }
  }

  window.addEventListener("load", () => {
    updateHighscoreBoard();
  });
</script>

  <style>
    #game-container {
      position: relative;
    }

    #gameCanvas {
      position: relative;
      z-index: 99;
    }

    #bikeFlyer {
      position: absolute;
      left: 100%;
      top: 100%;
      width: 180px;
      display: none;
      z-index: 1;
      pointer-events: none;
    }
  </style>
  
  <img id="bikeFlyer" src="pointpay-bike.png" style="position:absolute; display:none; width:180px;" />

  <script>
    function animateFlyer(flyerId, duration, delay) {
      setTimeout(() => {
        const flyer = document.getElementById(flyerId);
        flyer.style.display = "block";

        const startX = window.innerWidth + 100;
        const endX = -200;
        const startY = window.innerHeight + 100;
        const endY = -150;
        let startTime = null;

        function animate(timestamp) {
          if (!startTime) startTime = timestamp;
          const elapsed = timestamp - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const step = elapsed / 16;

          const baseX = startX + (endX - startX) * progress;
          const baseY = startY + (endY - startY) * progress;

          const wobbleX = Math.sin(step / 10) * 3;
          const wobbleY = Math.cos(step / 15) * 3;

          const x = baseX + wobbleX;
          const y = baseY + wobbleY;

          flyer.style.left = `${x}px`;
          flyer.style.top = `${y}px`;

          if (progress < 1) {
            requestAnimationFrame(animate);
          } else {
            flyer.style.display = "none";
          }
        }

        requestAnimationFrame(animate);
      }, delay);
    }

    // Start eerste run
    animateFlyer("bikeFlyer", 20000, 1000);
    // Herhaal elke 30 sec
    setInterval(() => animateFlyer("bikeFlyer", 20000, 1000), 30000);
  </script>

  <!-- Externe scripts -->
  <script src="login.js"></script>

  <!-- Muziekalbumscript -->
  <script>
    const albumTracks = [
      new Audio("track1.mp3"),
      new Audio("track2.mp3"),
      new Audio("track3.mp3"),
      new Audio("track4.mp3"),
      new Audio("track5.mp3"),
      new Audio("track6.mp3"),
    ];

    let currentTrackIndex = 0;
    let musicPlaying = false;

    albumTracks.forEach((track, index) => {
      track.loop = false;

      track.addEventListener("ended", () => {
        currentTrackIndex = (currentTrackIndex + 1) % albumTracks.length;

        albumTracks.forEach(t => {
          t.pause();
          t.currentTime = 0;
        });

        if (musicPlaying) {
          albumTracks[currentTrackIndex].play();
        }
      });
    });
  </script>  
  
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const musicBtn = document.getElementById('musicToggle');
    if (!musicBtn) return;

    function updateBtnUI(playing){
      musicBtn.title = playing ? 'Stop Music' : 'Play Music';
      musicBtn.alt   = playing ? 'Stop Music' : 'Play Music';
      musicBtn.src   = playing ? 'playmusic button.png' : 'playmusic button.png';
    }
    updateBtnUI(musicPlaying);

    musicBtn.addEventListener('click', () => {
      musicPlaying = !musicPlaying;

      albumTracks.forEach(t => { t.pause(); t.currentTime = 0; });

      if (musicPlaying) {
        const p = albumTracks[currentTrackIndex].play();
        if (p && typeof p.catch === 'function') {
          p.catch(() => { musicPlaying = false; updateBtnUI(false); });
        }
      } else {
        currentTrackIndex = 0;
      }

      updateBtnUI(musicPlaying);
      musicBtn.blur();
    });
  });
  </script>

<!-- üí¨ Chat open/dicht -->
<script>
(() => {
  const chat = document.getElementById('chatbox');
  const toggleBtn = document.getElementById('chatToggleBtn');
  const chatInput = document.getElementById('chatInput');

  // laatste status terugzetten
  try {
    if (localStorage.getItem('chatCollapsed') === '1') {
      chat.classList.add('collapsed');
    }
  } catch (e) {}

  // alleen met de knop open/dicht
  toggleBtn?.addEventListener('click', () => {
    chat.classList.toggle('collapsed');
    try {
      localStorage.setItem(
        'chatCollapsed',
        chat.classList.contains('collapsed') ? '1' : '0'
      );
    } catch (e) {}
  });

  // ‚õî spatie mag chat NIET meer openen/sluiten
  window.addEventListener('keydown', (e) => {
    // laat spatie met rust voor het spel
    if (e.code === 'Space') return;

    // als je in het chat-inputje zit, gewoon typen
    if (document.activeElement === chatInput) return;

    // escape mag chat w√©l dicht gooien
    if (e.code === 'Escape') {
      chat.classList.add('collapsed');
      try {
        localStorage.setItem('chatCollapsed', '1');
      } catch (e) {}
    }
  });
})();
</script>

<!-- üì± auto-fix voor mobiele schermen -->
<script>
  document.addEventListener('DOMContentLoaded', autoPlaceCanvas);
  window.addEventListener('resize', autoPlaceCanvas);

  function autoPlaceCanvas() {
    // alleen op mobiel
    if (window.innerWidth > 768) return;

    const c = document.getElementById('gameCanvas');
    if (!c) return;

    const ratio = 600 / 645;
    const vw = window.innerWidth;
    const canvasWidth = Math.min(vw * 0.84, 550);
    const canvasHeight = canvasWidth * ratio;

    c.width = canvasWidth;
    c.height = canvasHeight;

    const vh = window.innerHeight;
    const minTop = 180;                 // ‚Üê zelfde waarde als in CSS
    const centeredTop = (vh - canvasHeight) / 2;
    const finalTop = Math.max(minTop, centeredTop);

    c.style.top = finalTop + 'px';
  }
</script>


</body>
</html>


